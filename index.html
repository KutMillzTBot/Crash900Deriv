<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Crash900 Multiplier Bot</title>

<script src="https://unpkg.com/@deriv/deriv-api/dist/DerivAPIBasic.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#0f172a;
    color:white;
}
.section{
    padding:15px;
    border-bottom:1px solid #1e293b;
}
input,select{
    padding:8px;
    width:250px;
    margin:5px 0;
    background:#1e293b;
    color:white;
    border:1px solid #334155;
}
button{
    padding:10px 20px;
    background:#22c55e;
    border:none;
    color:black;
    font-weight:bold;
    cursor:pointer;
}
button:hover{opacity:0.8;}
.log-box{
    background:#111827;
    padding:10px;
    height:120px;
    overflow:auto;
    font-size:13px;
}
.popup{
    position:fixed;
    top:20px;
    right:20px;
    background:#22c55e;
    color:black;
    padding:10px;
    display:none;
    z-index:1000;
}
iframe{
    width:100%;
    height:750px;
    border:none;
}
</style>
</head>
<body>

<!-- BOT CONTROLS -->
<div class="section">
<h3>Deriv API</h3>
<input type="text" id="apiToken" placeholder="Enter Deriv API Token"><br>
<button id="startBot">START BOT</button>
</div>

<div class="section">
<h3>Trade Settings</h3>

Duration (Ticks):<br>
<input type="number" id="duration" value="5"><br>

Multiplier:<br>
<select id="multiplier">
<option value="20">20x</option>
<option value="50">50x</option>
<option value="100">100x</option>
<option value="200">200x</option>
</select><br>

Take Profit %:<br>
<input type="number" id="takeProfit" value="30"><br>

Max Trades:<br>
<input type="number" id="maxTrades" value="5"><br>

</div>

<div class="popup" id="livePopup"></div>

<div class="section">
<h3>Transaction History</h3>
<div class="log-box" id="history"></div>
</div>

<div class="section">
<h3>System Log</h3>
<div class="log-box" id="log"></div>
</div>

<!-- REAL DERIV TERMINAL -->
<div class="section">
<h3>Live Deriv Chart Terminal</h3>
<iframe src="https://app.deriv.com/trader?symbol=CRASH900"></iframe>
</div>

<script>

let api, connection;
let rangeArray=[];
let running=false;
let tradeCount=0;
let observationMode=false;
let activeContractId=null;
let entryStake=10;

function log(msg){
document.getElementById("log").innerHTML+=msg+"<br>";
}

function showPopup(msg){
let pop=document.getElementById("livePopup");
pop.innerHTML=msg;
pop.style.display="block";
setTimeout(()=>{pop.style.display="none";},3000);
}

async function connect(){
const token=document.getElementById("apiToken").value;
connection=new WebSocket("wss://ws.derivws.com/websockets/v3?app_id=1089");
api=new DerivAPIBasic({connection});
await api.authorize(token);
log("Connected to Deriv");
}

async function getCandle(){
const candles=await api.ticksHistory({
ticks_history:"CRASH900",
style:"candles",
granularity:60,
count:50
});
return candles.candles;
}

function calculateSpike(candles){
let last=candles[candles.length-1];
let range=last.high-last.low;
rangeArray.push(range);
if(rangeArray.length>30)rangeArray.shift();
let avg=rangeArray.reduce((a,b)=>a+b,0)/rangeArray.length;
return (range>avg*2.5)&&(last.close<last.open);
}

async function buyTrade(){

if(observationMode)return;

const maxTrades=parseInt(document.getElementById("maxTrades").value);
if(tradeCount>=maxTrades){
observationMode=true;
log("MaxTrades reached → Observation Mode ON");
showPopup("Observation Mode Activated");
return;
}

const duration=document.getElementById("duration").value;
const multiplier=document.getElementById("multiplier").value;

const proposal=await api.proposal({
proposal:1,
amount:entryStake,
basis:"stake",
contract_type:"MULTUP",
currency:"USD",
duration:duration,
duration_unit:"t",
symbol:"CRASH900",
multiplier:multiplier
});

const buy=await api.buy({buy:proposal.proposal.id,price:entryStake});
activeContractId=buy.buy.contract_id;
tradeCount++;

log("BUY EXECUTED ID: "+activeContractId);
document.getElementById("history").innerHTML+="BUY ID: "+activeContractId+"<br>";
showPopup("BUY EXECUTED");

monitorTakeProfit();
}

async function monitorTakeProfit(){
const tpPercent=parseFloat(document.getElementById("takeProfit").value);

connection.addEventListener("message",async(event)=>{
const data=JSON.parse(event.data);

if(data.proposal_open_contract &&
data.proposal_open_contract.contract_id===activeContractId){

let profit=data.proposal_open_contract.profit;
if(profit>0){
let percent=(profit/entryStake)*100;
if(percent>=tpPercent){
await api.sell({
sell:activeContractId,
price:data.proposal_open_contract.bid_price
});
log("Take Profit Hit → Contract Closed");
showPopup("TAKE PROFIT HIT");
activeContractId=null;
}
}
}
});

await api.proposalOpenContract({
proposal_open_contract:1,
contract_id:activeContractId,
subscribe:1
});
}

async function startBot(){
if(running)return;
running=true;

await connect();
log("Bot Started");

setInterval(async()=>{
if(observationMode)return;
const candles=await getCandle();
if(calculateSpike(candles)){
log("Spike detected → BUY");
await buyTrade();
}
},60000);
}

document.getElementById("startBot").onclick=startBot;

</script>

</body>
</html>
